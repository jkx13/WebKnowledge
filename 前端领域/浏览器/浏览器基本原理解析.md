## Chrom架构[](https://segmentfault.com/a/1190000040896436)
### 1.线程和进程区别
多线程可以并行处理任务，线程不能单独存在，它是由进程来启动和管理的。一个进程是一个程序的运行实例。

## 2.线程和进程的关系
- 进程中任意一线程执行出错，都会导致整个进程的崩溃。
- 线程之间共享进程中的数据。
- 当一个进程关闭后，操作系统会回收进程所占用的内存。
- 进程之间的内容相互隔离。

### 3.单进程 浏览器
- 不稳定。单进程中的插件、渲染线程崩溃导致整个浏览器崩溃。
- 不流畅。脚本（死循环）或插件会使浏览器卡顿。
- 不安全。插件和脚本可以获取到操作系统任意资源。

#### 4.多进程浏览器
- 解决不稳定。进程相互隔离，一个页面或者插件崩溃时，影响仅仅时当前插件或者页面，不会影响到其他页面。
- 解决不流畅。脚本阻塞当前页面渲染进程，不会影响到其他页面。
- 解决不安全。采用多进程架构使用沙箱。沙箱看成时操作系统给进程上来一把锁，沙箱的程序可以运行，但是不能在硬盘上写入任何数据，也不能在敏感位置读取任何数据

### 5.多进程架构
分为 浏览器进程、渲染进程、GPU 进程、网络进程、插件进程
**缺点**：1、资源占用高。2、体系架构复杂。

## 6.面向服务架构：
把原来的各种模块重构成独立的服务，每个服务都可以在独立的进程中运行，访问服务必须使用定义好的接口，通过 IPC 通讯，使得系统更内聚、松耦合、易维护和拓展。

## HTTP 请求流程：为什么很多站点第二次打开速度会很快
浏览器中的 HTTP 请求从发起到结束一共经历如下八个阶段：构建请求、查找缓存、准备 IP 和端口、等待 TCP 队列、建立 TCP 连接、发起 HTTP 请求、服务器处理请求、服务器返回请求和断开连接；

- 构建请求。浏览器构建请求行，构建好后，准备发起网络请求；
- 查找缓存。在真正发起请求前浏览器会查询缓存中是否有请求资源副本，有304则拦截请求，返回资源副本，否则进入网络请求；
- 准备 IP 地址和端口。HTTP 网络请求需要和服务器建立 TCP 连接，而建立 TCP 连接需要准备 IP 地址和端口号，浏览器需要请求 DNS 返回域名对应的 IP，同时会缓存域名解析结果，供下次查询使用；
- 等待 TCP 队列。Chrome 机制，同一个域名同时最多只能建立 6 个 TCP 连接；
- 建立 TCP 连接。TCP 通过“三次握手”建立连接，传输数据，“四次挥手”断开连接；
- 发送 HTTP 请求。建立 TCP 连接后，浏览器就可以和服务器进行 HTTP 数据传输了，首先会向服务器发送请求行，然后以请求头形式发送一些其他信息，如果是 POST 请求还会发送请求体；
- 服务器处理请求。首先服务器会返回响应行，随后，服务器向浏览器发送响应头和响应体。通常服务器返回数据，就要关闭 TCP 连接，如果请求头或者响应头有 Connection:keep-alive TCP 保持打开状态；

## 导航流程：从输入 URL 到页面展示这中间发生了什么
- 1. 用户输入 URL 并回车
- 2. 浏览器进程检查 URL，组装协议，构成完整 URL
- 3. 浏览器进程通过进程通信（IPC）把 URL 请求发送给网络进程
- 4. 网络进程接收到 URL 请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程
- 5. 如果没有，网络进程向 web 服务器发起 http 请求（网络请求），请求流程如下：
	- 进行 DNS 解析，获取服务器 IP 地址，端口
	- 利用 IP 地址和服务器建立 TCP 连接
	- 构建请求头信息
	- 发送请求头信息
	- 服务器响应后，网络进程接收响应头和响应信息，并解析响应内容
- 6. 网络进程解析响应流程：
	- 检查状态码，如果是 301/302，则需要重定向，从 Location 自动读取地址，重新进行第 4 步，如果是 200，则继续处理请求
	- 200 响应处理：检查响应类型 Content-Type，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续渲染。
	- 如果是 html 则通知浏览器进程准备渲染进程进行渲染准备渲染进程

	- 浏览器进程检查当前 URL 是否和之前打开的渲染进程根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程
	传输数据、更新状态

	- 渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的“管道”
	- 渲染进程接收完数据后，向浏览器发送“确认提交”
	- 浏览器进程接收到确认消息后 engine 浏览器界面状态：安全、地址 URL、前进后退的历史状态、更新 web 页面

## 注：TCP详解
### 1. TCP 由来
- 互联网络与单个网络有很大的不同，因为互联网络的不同部分可能有截然不同的拓扑结构、带宽、延迟、数据包大小和其他参数。
- TCP的设计目标是能够动态地适应互联网络的这些特性，而且具备面对各种故障时的健壮性。
- 不同主机的应用层之间经常需要可靠的、像管道一样的连接，但是IP层不提供这样的流机制，而是提供不可靠的包交换。

### 2. TCP协议机制
- 应用层向TCP层发送用于网间传输的、用**8位字节**表示的数据流，然后TCP把数据流**分区成适当长度的报文段**（通常受该计算机连接的网络的数据链路层的**最大传输单元（MTU）**的限制）。
- 之后TCP把结果包传给IP层，由它来通过网络将包传送给接收端**实体的TCP层**。
- TCP为了保证不发生丢包，就给**每个包一个序号**，同时序号也保证了传送到接收端实体的包的**按序接收**。
- 然后接收端实体对已成功收到的包发回**一个相应的确认（ACK）**；如果发送端实体在**合理的往返时延（RTT）**内未收到确认，那么对应的数据包就被假设为**已丢失将会被进行重传**。
- TCP**用一个校验和函数**来检验数据是否有错误；在**发送和接收时都要计算校验**
